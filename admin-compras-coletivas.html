<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin — Compra Coletiva | Floresta Vital</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    html { overflow-x: hidden; }
    body { overflow-x: hidden; max-width: 100vw; }
    .admin-wrap { max-width: min(1400px, 96vw); margin: 0 auto; padding: var(--space-lg); padding-top: calc(80px + var(--space-lg)); box-sizing: border-box; width: 100%; }
    .admin-login .card { max-width: 400px; margin: 0 auto; }
    .admin-msg { margin: var(--space-md) 0; padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md); }
    .admin-msg-ok { background: rgba(107, 142, 106, 0.15); color: var(--forest); }
    .admin-msg-error { background: rgba(180, 80, 60, 0.1); color: var(--forest-dark); }
    .admin-table { width: 100%; min-width: 680px; border-collapse: collapse; margin: var(--space-md) 0; font-size: 0.9rem; }
    .admin-table th, .admin-table td { padding: var(--space-xs) var(--space-sm); text-align: left; border-bottom: 1px solid rgba(45, 74, 62, 0.1); }
    .admin-table th { background: var(--sand); color: var(--forest); font-weight: 600; }
    .admin-table input[type="text"], .admin-table input[type="number"] { width: 100%; min-width: 0; padding: 4px 8px; border: 1px solid var(--sand); border-radius: var(--radius-sm); box-sizing: border-box; }
    .admin-table input[type="checkbox"] { margin: 0; }
    .admin-section { margin-bottom: var(--space-xl); }
    .admin-section h2 { color: var(--forest); margin-bottom: var(--space-md); font-size: 1.25rem; }
    .admin-actions { display: flex; gap: var(--space-sm); flex-wrap: wrap; align-items: center; margin-bottom: var(--space-md); }
    .admin-actions .btn { margin: 0; min-height: 44px; }
    .admin-back { display: inline-block; margin-bottom: var(--space-md); color: var(--sage); font-size: 0.9rem; }
    .admin-back:hover { color: var(--forest); }
    .admin-table-wrap { overflow-x: auto; overflow-y: visible; -webkit-overflow-scrolling: touch; margin: 0 calc(-1 * var(--space-lg)); padding: 0 var(--space-lg); }
    .admin-table-wrap .admin-table { margin-left: 0; margin-right: 0; }
    @media (min-width: 1024px) {
      .admin-wrap { max-width: min(1400px, 96vw); padding-left: var(--space-xl); padding-right: var(--space-xl); }
      .admin-table-wrap { overflow-x: visible; margin: 0; padding: 0; }
      .admin-table { min-width: auto; width: 100%; table-layout: auto; }
    }
    @media (max-width: 768px) {
      .admin-wrap { padding: var(--space-md); padding-top: calc(70px + var(--space-md)); }
      .admin-actions { flex-direction: column; align-items: stretch; }
      .admin-actions .btn { width: 100%; }
      .admin-actions[style*="space-between"] { flex-direction: column; }
      .admin-actions[style*="space-between"] h2 { margin-bottom: var(--space-sm); }
      .admin-table-wrap { margin: 0 -var(--space-md); padding: 0 var(--space-md); }
      .admin-table { font-size: 0.85rem; }
      .admin-table th, .admin-table td { padding: var(--space-xs) 6px; }
    }
    @media (max-width: 480px) {
      .admin-wrap { padding: var(--space-sm); padding-top: calc(60px + var(--space-sm)); }
      .admin-table-wrap { margin: 0 -var(--space-sm); padding: 0 var(--space-sm); }
    }
    .admin-status-legend { font-size: 0.875rem; color: var(--text-soft); margin-bottom: var(--space-md); }
    .admin-status-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }
    .admin-status-ativo { background: rgba(107, 142, 106, 0.2); color: var(--forest); }
    .admin-status-separado { background: rgba(70, 100, 180, 0.15); color: #2d4a9e; }
    .admin-status-entregue { background: rgba(80, 120, 80, 0.2); color: #2d5a2d; }
    .admin-status-cancelado { background: rgba(120, 80, 80, 0.15); color: #8b4545; }
    .admin-acoes-next { font-size: 0.85rem; }
    .admin-acoes-done { color: var(--text-soft); font-size: 0.85rem; }
  </style>
</head>
<body>
  <header class="header" id="header">
    <nav class="nav container">
      <a href="index.html" class="logo">Floresta <span>Vital</span></a>
      <ul class="nav-links" id="navLinks">
        <li><a href="index.html">Início</a></li>
        <li><a href="compras-coletivas.html">Compra Coletiva</a></li>
      </ul>
      <button class="theme-toggle" id="themeToggle" aria-label="Usar modo escuro" title="Modo escuro"></button>
    </nav>
  </header>

  <main class="admin-wrap">
    <a href="compras-coletivas.html" class="admin-back">← Voltar à Compra Coletiva</a>
    <div id="adminMsg" class="admin-msg" role="alert" aria-live="polite"></div>

    <div id="adminLogin" class="admin-login">
      <div class="card">
        <h1 style="color: var(--forest); margin-bottom: var(--space-md); font-size: 1.5rem;">Configuração — apenas admin</h1>
        <p style="color: var(--text-soft); margin-bottom: var(--space-md); font-size: 0.95rem;">Acesso restrito ao administrador. Digite o token configurado no Google Apps Script (Propriedades do projeto → ADMIN_TOKEN).</p>
        <div class="form-group">
          <label for="adminToken">Token</label>
          <input type="password" id="adminToken" class="admin-input" placeholder="Token" autocomplete="off" aria-label="Token de administrador">
        </div>
        <button type="button" class="btn btn-primary" id="adminBtnEntrar">Entrar</button>
      </div>
    </div>

    <div id="adminPainel" style="display: none;">
      <div class="admin-actions" style="justify-content: space-between;">
        <h2 style="margin: 0;">Gestão de itens e pedidos</h2>
        <button type="button" class="btn btn-secondary" id="adminBtnSair">Sair</button>
      </div>

      <section class="admin-section">
        <h2>Itens do catálogo</h2>
        <p style="font-size: 0.9rem; color: var(--text-soft); margin-bottom: var(--space-md);">Use a linha abaixo para adicionar um novo item; edite os existentes e clique em &quot;Salvar alterações&quot;.</p>
        <div class="admin-add-item-row" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: var(--space-sm); align-items: end; margin-bottom: var(--space-md); flex-wrap: wrap;">
          <div class="form-group" style="margin: 0;"><label for="adminNewId">Id</label><input type="text" id="adminNewId" class="admin-input" placeholder="ex: cebola" style="width: 100%;" aria-label="Id do novo item"></div>
          <div class="form-group" style="margin: 0;"><label for="adminNewNome">Nome</label><input type="text" id="adminNewNome" class="admin-input" placeholder="Nome" style="width: 100%;" aria-label="Nome"></div>
          <div class="form-group" style="margin: 0;"><label for="adminNewUnidade">Unidade</label><input type="text" id="adminNewUnidade" class="admin-input" placeholder="kg" style="width: 100%;" aria-label="Unidade"></div>
          <div class="form-group" style="margin: 0;"><label for="adminNewAtivo">Ativo</label><input type="checkbox" id="adminNewAtivo" checked aria-label="Ativo" style="margin-top: 8px;"></div>
          <div class="form-group" style="margin: 0;"><label for="adminNewEstoque">Estoque</label><input type="number" id="adminNewEstoque" class="admin-input" min="0" value="0" style="width: 100%;" aria-label="Estoque"></div>
          <div class="form-group" style="margin: 0;"><label for="adminNewPreco">Preço</label><input type="number" id="adminNewPreco" class="admin-input" min="0" step="0.01" value="0" style="width: 100%;" aria-label="Preço"></div>
          <div class="form-group" style="margin: 0;"><label for="adminNewOrdem">Ordem</label><input type="number" id="adminNewOrdem" class="admin-input" min="0" value="0" style="width: 100%;" aria-label="Ordem"></div>
          <div class="form-group" style="margin: 0;"><label for="adminNewImagem">Imagem (URL)</label><input type="url" id="adminNewImagem" class="admin-input" placeholder="https://…" style="width: 100%;" aria-label="URL da imagem"></div>
          <div class="form-group" style="margin: 0;"><label>&nbsp;</label><button type="button" class="btn btn-primary" id="adminBtnAdicionarItem">Adicionar item</button></div>
        </div>
        <div class="admin-actions">
          <button type="button" class="btn btn-primary" id="adminBtnSalvar">Salvar alterações</button>
        </div>
        <div class="admin-table-wrap">
          <table class="admin-table" id="adminItensTable" aria-label="Itens do catálogo">
            <thead>
              <tr>
                <th>Id</th>
                <th>Nome</th>
                <th>Unidade</th>
                <th>Ativo</th>
                <th>Estoque</th>
                <th>Preço</th>
                <th>Ordem</th>
                <th>Imagem (URL)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="admin-section">
        <h2>Resumo por item (últimos 20 pedidos)</h2>
        <div id="adminResumoItens"></div>
      </section>

      <section class="admin-section">
        <h2>Pedidos recentes (últimos 20)</h2>
        <p class="admin-status-legend">Fluxo: <strong>Ativo</strong> (na separação) → <strong>Separado</strong> (aba Pedidos separados) → <strong>Entregue</strong> (aba Pedidos entregues). Use os botões para avançar o status.</p>
        <div class="admin-actions">
          <button type="button" class="btn btn-secondary" id="adminBtnExportCsv">Exportar CSV</button>
        </div>
        <div class="admin-table-wrap">
          <table class="admin-table" id="adminOrdersTable" aria-label="Pedidos recentes">
            <thead>
              <tr>
                <th>ID Pedido</th>
                <th>Data/Hora</th>
                <th>Nome</th>
                <th>E-mail</th>
                <th>Telefone</th>
                <th>Bairro</th>
                <th>Status</th>
                <th>Itens</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="admin-section admin-section-backup" style="text-align: center; max-width: 560px; margin-left: auto; margin-right: auto;">
        <h2>Backup da planilha</h2>
        <p style="font-size: 0.9rem; color: var(--text-soft); margin-bottom: var(--space-md);">Crie uma cópia da planilha (Items, Users, Orders) na pasta &quot;Backups Compra Coletiva&quot; no mesmo Drive, ou restaure a partir de um backup anterior.</p>
        <div class="admin-actions" style="justify-content: center; flex-wrap: wrap;">
          <button type="button" class="btn btn-primary" id="adminBtnSalvarBackup">Salvar backup</button>
          <span style="display: inline-flex; align-items: center; gap: var(--space-sm); flex-wrap: wrap; justify-content: center;">
            <select id="adminSelectBackup" class="admin-input" aria-label="Escolher backup para restaurar" style="min-width: 220px; padding: 8px 12px;">
              <option value="">— Carregar backups —</option>
            </select>
            <button type="button" class="btn btn-secondary" id="adminBtnRestaurarBackup">Restaurar este backup</button>
          </span>
        </div>
        <p id="adminBackupMsg" class="admin-msg" style="margin-top: var(--space-sm); display: none;" role="alert"></p>
      </section>
    </div>
  </main>

  <script src="js/config.js"></script>
  <script src="js/admin-compras-coletivas.js"></script>
  <script src="js/theme.js"></script>
  <script>
    window.addEventListener('scroll', function () {
      document.getElementById('header').classList.toggle('scrolled', window.scrollY > 20);
    });
  </script>
</body>
</html>
