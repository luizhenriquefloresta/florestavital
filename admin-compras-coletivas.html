<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <title>Admin — Compra Coletiva | Floresta Vital</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    html { overflow-x: hidden; }
    body { overflow-x: hidden; max-width: 100vw; }
    .admin-wrap { max-width: min(1400px, 96vw); margin: 0 auto; padding: var(--space-lg); padding-top: calc(80px + var(--space-lg)); box-sizing: border-box; width: 100%; }
    .admin-login .card { max-width: 400px; margin: 0 auto; }
    .admin-msg { margin: var(--space-md) 0; padding: var(--space-sm) var(--space-md); border-radius: var(--radius-md); }
    .admin-msg-ok { background: rgba(107, 142, 106, 0.15); color: var(--forest); }
    .admin-msg-error { background: rgba(180, 80, 60, 0.1); color: var(--forest-dark); }
    .admin-table { width: 100%; min-width: 680px; border-collapse: collapse; margin: var(--space-md) 0; font-size: 0.9rem; }
    .admin-table th, .admin-table td { padding: var(--space-xs) var(--space-sm); text-align: left; border-bottom: 1px solid rgba(45, 74, 62, 0.1); }
    .admin-table th { background: var(--sand); color: var(--forest); font-weight: 600; }
    .admin-table input[type="text"], .admin-table input[type="number"] { width: 100%; min-width: 0; padding: 4px 8px; border: 1px solid var(--sand); border-radius: var(--radius-sm); box-sizing: border-box; }
    .admin-table input[type="checkbox"] { margin: 0; }
    .admin-section { margin-bottom: var(--space-xl); }
    .admin-section h2 { color: var(--forest); margin-bottom: var(--space-md); font-size: 1.25rem; }
    .admin-actions { display: flex; gap: var(--space-sm); flex-wrap: wrap; align-items: center; margin-bottom: var(--space-md); }
    .admin-actions .btn { margin: 0; min-height: 44px; }
    .admin-back { display: inline-block; margin-bottom: var(--space-md); color: var(--sage); font-size: 0.9rem; }
    .admin-back:hover { color: var(--forest); }
    .admin-table-wrap { overflow-x: auto; overflow-y: visible; -webkit-overflow-scrolling: touch; margin: 0 calc(-1 * var(--space-lg)); padding: 0 var(--space-lg); }
    .admin-table-wrap .admin-table { margin-left: 0; margin-right: 0; }
    @media (min-width: 1024px) {
      .admin-wrap { max-width: min(1400px, 96vw); padding-left: var(--space-xl); padding-right: var(--space-xl); }
      .admin-table-wrap { overflow-x: visible; margin: 0; padding: 0; }
      .admin-table { min-width: auto; width: 100%; table-layout: auto; }
    }
    @media (max-width: 768px) {
      .admin-wrap { padding: var(--space-md); padding-top: calc(70px + var(--space-md)); }
      .admin-actions { flex-direction: column; align-items: stretch; }
      .admin-actions .btn { width: 100%; }
      .admin-actions[style*="space-between"] { flex-direction: column; }
      .admin-actions[style*="space-between"] h2 { margin-bottom: var(--space-sm); }
      .admin-table-wrap { margin: 0 -var(--space-md); padding: 0 var(--space-md); }
      .admin-table { font-size: 0.85rem; }
      .admin-table th, .admin-table td { padding: var(--space-xs) 6px; }
    }
    @media (max-width: 480px) {
      .admin-wrap { padding: var(--space-sm); padding-top: calc(60px + var(--space-sm)); }
      .admin-table-wrap { margin: 0 -var(--space-sm); padding: 0 var(--space-sm); }
    }
    .admin-status-legend { font-size: 0.875rem; color: var(--text-soft); margin-bottom: var(--space-md); }
    .admin-status-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; }
    .admin-status-ativo { background: rgba(107, 142, 106, 0.2); color: var(--forest); }
    .admin-status-separado { background: rgba(70, 100, 180, 0.15); color: #2d4a9e; }
    .admin-status-entregue { background: rgba(80, 120, 80, 0.2); color: #2d5a2d; }
    .admin-status-cancelado { background: rgba(120, 80, 80, 0.15); color: #8b4545; }
    .admin-acoes-next { font-size: 0.85rem; }
    .admin-acoes-done { color: var(--text-soft); font-size: 0.85rem; }
    /* Botões menores na admin */
    .admin-wrap .btn { padding: 6px 14px; font-size: 0.85rem; min-height: 36px; }
    .admin-wrap .btn.btn-sm { padding: 4px 10px; font-size: 0.8rem; min-height: 32px; }
    .admin-table .admin-new-item-row td { background: rgba(45, 74, 62, 0.05); }
    /* Select alinhado ao design system (form-group) */
    .admin-wrap select,
    .admin-wrap select.admin-input {
      width: 100%;
      max-width: 100%;
      min-height: 40px;
      padding: var(--space-sm) var(--space-md);
      font-family: var(--font-body);
      font-size: 0.9rem;
      border: 2px solid var(--sand);
      border-radius: var(--radius-md);
      background: var(--cream);
      color: var(--text);
      transition: border-color 0.2s ease;
      cursor: pointer;
    }
    .admin-wrap select:focus {
      outline: none;
      border-color: var(--sage);
    }
    html[data-theme="dark"] .admin-wrap select,
    html[data-theme="dark"] .admin-wrap select.admin-input {
      background: var(--cream);
      border-color: var(--sand);
      color: var(--text);
    }
    html[data-theme="dark"] .admin-wrap select:focus {
      border-color: var(--sage);
    }
    /* Abas principais: Novo pedido | Pedidos */
    .admin-main-tabs { display: flex; gap: 2px; margin-bottom: var(--space-lg); border-bottom: 2px solid var(--sand); }
    .admin-main-tab {
      padding: var(--space-md) var(--space-lg); font-size: 1rem; font-weight: 600; border: none; border-bottom: 3px solid transparent;
      margin-bottom: -2px; background: transparent; color: var(--text-soft); cursor: pointer; border-radius: var(--radius-sm) var(--radius-sm) 0 0;
      transition: color 0.2s, border-color 0.2s, background 0.2s;
    }
    .admin-main-tab:hover { color: var(--forest); background: rgba(45, 74, 62, 0.06); }
    .admin-main-tab.active { color: var(--forest); border-bottom-color: var(--sage); background: rgba(107, 142, 106, 0.08); }
    html[data-theme="dark"] .admin-main-tab.active { background: rgba(107, 142, 106, 0.12); }
    .admin-panel-content { display: none; }
    .admin-panel-content.active { display: block; }
    /* Form Novo pedido */
    .admin-new-order-form { max-width: 560px; }
    .admin-new-order-form .form-group { margin-bottom: var(--space-md); }
    .admin-new-order-form label { display: block; margin-bottom: var(--space-xs); font-weight: 500; color: var(--forest); }
    .admin-new-order-form .admin-input { width: 100%; max-width: 100%; box-sizing: border-box; }
    .admin-new-order-itens { margin: var(--space-md) 0; padding: var(--space-sm) 0; border-top: 1px solid var(--sand); }
    .admin-new-order-itens h3 { font-size: 1rem; color: var(--forest); margin-bottom: var(--space-sm); }
    .admin-new-order-item-row { display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm); }
    .admin-new-order-item-row label { flex: 1; margin: 0; font-weight: normal; color: var(--text); }
    .admin-new-order-item-row input[type="number"] { width: 80px; min-width: 60px; }
    /* Abas de pedidos por status (dentro da aba Pedidos) */
    .admin-orders-tabs { display: flex; flex-wrap: wrap; gap: 2px; margin-bottom: var(--space-md); border-bottom: 2px solid var(--sand); }
    .admin-tab {
      padding: var(--space-sm) var(--space-md); font-size: 0.9rem; font-weight: 500; border: none; border-bottom: 3px solid transparent;
      margin-bottom: -2px; background: transparent; color: var(--text-soft); cursor: pointer; border-radius: var(--radius-sm) var(--radius-sm) 0 0;
      transition: color 0.2s, border-color 0.2s, background 0.2s;
    }
    .admin-tab:hover { color: var(--forest); background: rgba(45, 74, 62, 0.06); }
    .admin-tab.active { color: var(--forest); border-bottom-color: var(--sage); background: rgba(107, 142, 106, 0.08); }
    html[data-theme="dark"] .admin-tab.active { background: rgba(107, 142, 106, 0.12); }
  </style>
</head>
<body>
  <header class="header" id="header">
    <nav class="nav container">
      <a href="index.html" class="logo">Floresta <span>Vital</span></a>
      <ul class="nav-links" id="navLinks">
        <li><a href="index.html">Início</a></li>
        <li><a href="compras-coletivas.html">Compra Coletiva</a></li>
      </ul>
      <button class="theme-toggle" id="themeToggle" aria-label="Usar modo escuro" title="Modo escuro"></button>
    </nav>
  </header>

  <main class="admin-wrap">
    <a href="compras-coletivas.html" class="admin-back">← Voltar à Compra Coletiva</a>
    <div id="adminMsg" class="admin-msg" role="alert" aria-live="polite"></div>

    <div id="adminLogin" class="admin-login">
      <div class="card">
        <h1 style="color: var(--forest); margin-bottom: var(--space-md); font-size: 1.5rem;">Configuração — apenas admin</h1>
        <p style="color: var(--text-soft); margin-bottom: var(--space-md); font-size: 0.95rem;">Acesso restrito ao administrador. Digite o token configurado no Google Apps Script (Propriedades do projeto → ADMIN_TOKEN).</p>
        <div class="form-group">
          <label for="adminToken">Token</label>
          <input type="password" id="adminToken" class="admin-input" placeholder="Token" autocomplete="off" aria-label="Token de administrador">
        </div>
        <button type="button" class="btn btn-primary" id="adminBtnEntrar">Entrar</button>
      </div>
    </div>

    <div id="adminPainel" style="display: none;">
      <div class="admin-actions" style="justify-content: space-between;">
        <h2 style="margin: 0;">Gestão de itens e pedidos</h2>
        <button type="button" class="btn btn-secondary" id="adminBtnSair">Sair</button>
      </div>

      <div class="admin-main-tabs" role="tablist" aria-label="Navegação principal">
        <button type="button" class="admin-main-tab active" role="tab" aria-selected="true" data-main-tab="new">Novo pedido</button>
        <button type="button" class="admin-main-tab" role="tab" aria-selected="false" data-main-tab="list">Pedidos</button>
      </div>

      <div id="adminPanelNew" class="admin-panel-content active" role="tabpanel">
        <section class="admin-section">
          <h2>Registrar novo pedido</h2>
          <p style="font-size: 0.9rem; color: var(--text-soft); margin-bottom: var(--space-md);">Preencha os dados e as quantidades dos itens. O pedido será criado com status &quot;ativo&quot; (na separação).</p>
          <form id="adminFormNovoPedido" class="admin-new-order-form">
            <div class="form-group">
              <label for="adminNovoPedidoNome">Nome *</label>
              <input type="text" id="adminNovoPedidoNome" class="admin-input" required placeholder="Nome do cliente">
            </div>
            <div class="form-group">
              <label for="adminNovoPedidoEmail">E-mail</label>
              <input type="email" id="adminNovoPedidoEmail" class="admin-input" placeholder="email@exemplo.com">
            </div>
            <div class="form-group">
              <label for="adminNovoPedidoTelefone">Telefone *</label>
              <input type="tel" id="adminNovoPedidoTelefone" class="admin-input" required placeholder="(11) 99999-9999">
            </div>
            <div class="form-group">
              <label for="adminNovoPedidoBairro">Bairro</label>
              <input type="text" id="adminNovoPedidoBairro" class="admin-input" placeholder="Bairro">
            </div>
            <div class="form-group">
              <label for="adminNovoPedidoObs">Observações</label>
              <input type="text" id="adminNovoPedidoObs" class="admin-input" placeholder="Observações">
            </div>
            <div class="admin-new-order-itens">
              <h3>Itens e quantidades</h3>
              <div id="adminNovoPedidoItens"></div>
            </div>
            <button type="submit" class="btn btn-primary">Registrar pedido</button>
          </form>
        </section>
      </div>

      <div id="adminPanelList" class="admin-panel-content" role="tabpanel">
        <section class="admin-section">
          <h2>Pedidos recentes (últimos 20)</h2>
          <p class="admin-status-legend">Fluxo: <strong>Ativo</strong> (na separação) → <strong>Separado</strong> → <strong>Entregue</strong>. Use as abas para filtrar e os botões para avançar o status.</p>
          <div class="admin-orders-tabs" role="tablist" aria-label="Filtrar pedidos por status">
            <button type="button" class="admin-tab active" role="tab" aria-selected="true" data-orders-tab="">Todos</button>
            <button type="button" class="admin-tab" role="tab" aria-selected="false" data-orders-tab="ativo">Ativos</button>
            <button type="button" class="admin-tab" role="tab" aria-selected="false" data-orders-tab="separado">Separados</button>
            <button type="button" class="admin-tab" role="tab" aria-selected="false" data-orders-tab="entregue">Entregues</button>
            <button type="button" class="admin-tab" role="tab" aria-selected="false" data-orders-tab="cancelado">Cancelados</button>
          </div>
          <div class="admin-actions">
            <button type="button" class="btn btn-secondary" id="adminBtnExportCsv">Exportar CSV</button>
          </div>
          <div class="admin-table-wrap">
            <table class="admin-table" id="adminOrdersTable" aria-label="Pedidos recentes">
              <thead>
                <tr>
                  <th>ID Pedido</th>
                  <th>Data/Hora</th>
                  <th>Nome</th>
                  <th>E-mail</th>
                  <th>Telefone</th>
                  <th>Bairro</th>
                  <th>Status</th>
                  <th>Itens</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
      </div>

      <section class="admin-section">
        <h2>Itens do catálogo</h2>
        <p style="font-size: 0.9rem; color: var(--text-soft); margin-bottom: var(--space-sm);">Edite os itens na tabela; use a primeira linha para adicionar um novo item. Depois clique em "Salvar alterações".</p>
        <div class="admin-actions" style="margin-bottom: var(--space-sm);">
          <button type="button" class="btn btn-primary btn-sm" id="adminBtnSalvar">Salvar alterações</button>
        </div>
        <div class="admin-table-wrap">
          <table class="admin-table" id="adminItensTable" aria-label="Itens do catálogo">
            <thead>
              <tr>
                <th>Id</th>
                <th>Nome</th>
                <th>Unidade</th>
                <th>Ativo</th>
                <th>Estoque</th>
                <th>Preço</th>
                <th>Ordem</th>
                <th>Imagem (URL)</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <section class="admin-section">
        <h2>Resumo por item (últimos 20 pedidos)</h2>
        <div id="adminResumoItens"></div>
      </section>

      <section class="admin-section admin-section-backup" style="text-align: center; max-width: 560px; margin-left: auto; margin-right: auto;">
        <h2>Backup da planilha</h2>
        <p style="font-size: 0.9rem; color: var(--text-soft); margin-bottom: var(--space-md);">Crie uma cópia da planilha (Items, Users, Orders) na pasta "Backups Compra Coletiva" no mesmo Drive, ou restaure a partir de um backup anterior.</p>
        <div class="admin-actions" style="justify-content: center; flex-wrap: wrap;">
          <button type="button" class="btn btn-primary" id="adminBtnSalvarBackup">Salvar backup</button>
          <span style="display: inline-flex; align-items: center; gap: var(--space-sm); flex-wrap: wrap; justify-content: center;">
            <button type="button" class="btn btn-secondary btn-sm" id="adminBtnCarregarBackups">Carregar lista</button>
            <select id="adminSelectBackup" class="admin-input admin-select-backup" aria-label="Escolher backup para restaurar" style="min-width: 220px;">
              <option value="">— Carregar lista para escolher —</option>
            </select>
            <button type="button" class="btn btn-secondary" id="adminBtnRestaurarBackup">Restaurar este backup</button>
          </span>
        </div>
        <p id="adminBackupMsg" class="admin-msg" style="margin-top: var(--space-sm); display: none;" role="alert"></p>
      </section>
    </div>
  </main>

  <script src="js/config.js"></script>
  <script src="js/admin-compras-coletivas.js"></script>
  <script src="js/theme.js"></script>
  <script>
    window.addEventListener('scroll', function () {
      document.getElementById('header').classList.toggle('scrolled', window.scrollY > 20);
    });
  </script>
</body>
</html>
